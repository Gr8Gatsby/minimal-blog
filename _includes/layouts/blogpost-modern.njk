<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="{{ baseUrl }}assets/css/styles.css">
    <link rel="stylesheet" href="{{ baseUrl }}assets/css/blogpost.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .header {
            position: relative;
            height: 200px;
            background: linear-gradient(135deg, rgba(60, 120, 200, 0.6), rgba(20, 20, 50, 0.7)),
            url("{{ baseUrl }}{{ headerImage }}") center/cover;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            color: #ffffff;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
            margin-bottom: 15px;
        }
        
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .theme-toggle {
            cursor: pointer;
            font-size: 1.5rem;
            color: #ffffff;
            transition: color 0.3s;
        }

        /* Dark theme styling */
        .dark-theme {
            background-color: #121212;
            color: #ffffff;
        }

        .dark-theme .header {
            background: linear-gradient(135deg, rgba(20, 20, 50, 0.8), rgba(10, 10, 20, 0.9)),
            url("{{ baseUrl }}{{ headerImage }}") center/cover;
        }

        .dark-theme .theme-toggle {
            color: #f1c40f; /* Sun icon color in dark mode */
        }
    </style>
</head>
<body>
    <!-- Parallax Header Section with Overlay -->
    <header class="header">
        <a href="{{ baseUrl }}blog.html" class="back-button">‚Üê Back to Blog</a>
        <div class="controls">
            <!-- Sun and moon icons from Font Awesome -->
            <i id="themeToggle" class="theme-toggle fas fa-moon"></i>
        </div>
        <h1>{{ title }}</h1>
    </header>

    <!-- Main Content Section -->
    <main>
        <article class="blog-post">{{ content | safe }}</article>
    </main>

    <!-- Footer Section -->
    {% include 'footer.njk' %}

    <script>
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;

        // Check OS theme preference and stored theme choice
        function setInitialTheme() {
            const storedTheme = localStorage.getItem('theme');
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (storedTheme) {
                body.classList.toggle('dark-theme', storedTheme === 'dark');
            } else {
                body.classList.toggle('dark-theme', prefersDarkScheme);
            }

            // Set the icon based on the current theme
            updateThemeIcon();
        }

        // Update the theme icon based on current theme
        function updateThemeIcon() {
            if (body.classList.contains('dark-theme')) {
                themeToggle.classList.remove('fa-moon');
                themeToggle.classList.add('fa-sun');
            } else {
                themeToggle.classList.remove('fa-sun');
                themeToggle.classList.add('fa-moon');
            }
        }

        // Toggle theme on icon click and save preference
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-theme');
            const currentTheme = body.classList.contains('dark-theme') ? 'dark' : 'light';
            localStorage.setItem('theme', currentTheme);
            updateThemeIcon();
        });

        // Set the initial theme based on OS preference and stored choice
        setInitialTheme();
    </script>
</body>
</html>